<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Coaching Avanzato 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        /* Stili per le input fields per un aspetto piÃ¹ pulito */
        .data-input {
            width: 100%;
            padding: 8px 8px;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: transparent;
            text-align: center;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            min-height: 42px;
        }
        .data-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
        /* Stili per la tabella "sticky header" */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 10;
        }
    </style>
</head>
<body class="p-2 sm:p-4 md:p-8">

    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-lg p-4 sm:p-6">
        <!-- Header Principale -->
        <header class="w-full p-4 mb-6 rounded-lg bg-[#2c3e50] text-white text-center">
            <h1 class="text-xl sm:text-2xl font-bold">ğŸƒâ€â™‚ï¸ PIANO COACHING AVANZATO 2025: 104kg â†’ 95kg | 0' â†’ 35' CORSA | TIMING OTTIMIZZATO BCAA ğŸ¯</h1>
        </header>

        <!-- Navigazione a Tab -->
        <div class="border-b border-gray-200 mb-6">
            <nav class="-mb-px flex space-x-6 sm:space-x-8" aria-label="Tabs">
                <button data-tab="piano" class="whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-sm text-blue-600 border-blue-600">
                    Piano Giornaliero
                </button>
                <button data-tab="progressi" class="whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    Progressi e Obiettivi
                </button>
                <button data-tab="guide" class="whitespace-nowrap py-4 px-1 border-b-2 font-semibold text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    Guide e Parametri
                </button>
            </nav>
        </div>

        <!-- Contenuto delle Tab -->
        <div>
            <!-- Tab: Piano Giornaliero -->
            <div data-tab-content="piano">
                <div class="overflow-x-auto rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-[#34495e] sticky-header">
                            <tr>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[90px]">ğŸ“… Data</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[70px]">ğŸ“‹ Giorno</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[120px]">âš¡ Pre-Workout</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[140px]">ğŸŒ… Functional</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[160px]">ğŸŒ† Cardio/Corsa</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[130px]">ğŸ¥£ Colazione</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[130px]">ğŸ Pranzo</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[130px]">ğŸ— Cena</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[70px]">âš–ï¸ Peso</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[70px]">ğŸ’“ FC Med</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[70px]">â±ï¸ Passo</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[70px]">ğŸ˜´ Sonno</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[80px]">ğŸ”¥ Cal Bruciate (TDEE)</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[80px]">ğŸ½ï¸ Cal Ingerite</th>
                                <th class="px-2 py-3 text-center text-xs font-bold text-white uppercase tracking-wider w-[90px]">ğŸ“Š Bilancio</th>
                            </tr>
                        </thead>
                        <tbody id="training-plan-body" class="bg-white divide-y divide-gray-200">
                            <!-- Le righe del piano verranno inserite qui da JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tab: Progressi e Obiettivi -->
            <div data-tab-content="progressi" class="hidden">
                 <div class="space-y-8">
                    <section id="progress-tracking"></section>
                    <section id="advanced-goals"></section>
                </div>
            </div>

            <!-- Tab: Guide e Parametri -->
            <div data-tab-content="guide" class="hidden">
                <div class="space-y-8">
                    <section id="metabolic-parameters" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm"></section>
                    <section id="nutrition-guide"></section>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- LOGICA DI PERSISTENZA DATI ---
            const STORAGE_KEY = 'pianoCoachingData2025';

            function getStoredData() {
                try {
                    const data = localStorage.getItem(STORAGE_KEY);
                    return data ? JSON.parse(data) : {};
                } catch (e) {
                    console.error("Failed to parse data from localStorage", e);
                    return {};
                }
            }

            function saveData(key, value) {
                const data = getStoredData();
                data[key] = value;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            }

            function loadAndApplyData() {
                const storedData = getStoredData();
                if (Object.keys(storedData).length === 0) return;

                const inputs = document.querySelectorAll('.data-input');
                inputs.forEach(input => {
                    if (storedData[input.id] !== undefined) {
                        input.value = storedData[input.id];
                        // Trigger 'input' event to apply formatting and calculations
                        input.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });
                // A final update for the summary table after all data is loaded
                updateProgressTracking();
            }

            // --- LOGICA DI NAVIGAZIONE TAB ---
            const tabs = document.querySelectorAll('[data-tab]');
            const contents = document.querySelectorAll('[data-tab-content]');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetContent = document.querySelector(`[data-tab-content="${tab.dataset.tab}"]`);
                    tabs.forEach(t => {
                        t.classList.remove('text-blue-600', 'border-blue-600');
                        t.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    });
                    contents.forEach(c => c.classList.add('hidden'));
                    tab.classList.add('text-blue-600', 'border-blue-600');
                    tab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    targetContent.classList.remove('hidden');
                });
            });


            const planStartDate = new Date(2025, 8, 24); // 24 Settembre 2025

            const formatDate = (date) => {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                return `${day}/${month}`;
            };
            const getDayName = (date) => ["Dom", "Lun", "Mar", "Mer", "Gio", "Ven", "Sab"][date.getDay()];
            const tbody = document.getElementById('training-plan-body');

            // --- LOGICA DI AGGIORNAMENTO DINAMICO ---
            function updateProgressTracking() {
                const trackingWeeks = [1, 2, 4, 6, 8, 10, 12];
                trackingWeeks.forEach(weekNum => {
                    const dailyRows = document.querySelectorAll(`tr[data-week='${weekNum}']`);
                    if (dailyRows.length === 0) return;

                    let lastWeight = '';
                    for (let i = dailyRows.length - 1; i >= 0; i--) {
                        const weightInput = dailyRows[i].querySelector('input[data-metric="peso"]');
                        if (weightInput && weightInput.value) {
                            lastWeight = parseFloat(weightInput.value).toFixed(1) + ' kg';
                            break;
                        }
                    }
                    const pesoCell = document.getElementById(`track-w${weekNum}-peso`);
                    if (pesoCell) pesoCell.textContent = lastWeight;

                    const metricsToAverage = [
                        { key: 'passo', unit: ' min/km' }, { key: 'fc', unit: ' bpm' }, { key: 'sonno', unit: ' ore' }
                    ];
                    metricsToAverage.forEach(metricInfo => {
                        const values = Array.from(dailyRows).map(row => parseFloat(row.querySelector(`input[data-metric="${metricInfo.key}"]`)?.value)).filter(v => !isNaN(v));
                        const targetCell = document.getElementById(`track-w${weekNum}-${metricInfo.key}`);
                        if (targetCell) {
                            if (values.length > 0) {
                                const sum = values.reduce((a, b) => a + b, 0);
                                const avg = sum / values.length;
                                const formattedAvg = metricInfo.key === 'passo' ? avg.toFixed(2) : Math.round(avg);
                                targetCell.textContent = formattedAvg + (metricInfo.unit || '');
                            } else {
                                targetCell.textContent = '';
                            }
                        }
                    });

                    const deficitValues = Array.from(dailyRows).map(row => parseFloat(row.querySelector('td:last-child span')?.textContent)).filter(v => !isNaN(v));
                    const deficitCell = document.getElementById(`track-w${weekNum}-deficit`);
                    if (deficitCell) {
                        if (deficitValues.length > 0) {
                            const sum = deficitValues.reduce((a, b) => a + b, 0);
                            const avgDeficit = sum / deficitValues.length;
                            deficitCell.textContent = Math.round(avgDeficit) + ' kcal';
                        } else {
                            deficitCell.textContent = '';
                        }
                    }
                });
            }

            // --- FUNZIONI PER CREARE SEZIONI E RIGHE ---
            function addMetabolicParameters() {
                const container = document.getElementById('metabolic-parameters');
                const paramData = [
                    { title: "ğŸ“Š PARAMETRI METABOLICI", items: [["BMR stimato:", "2100 kcal"],["TDEE attuale:", "2900 kcal"],["Intake target:", "2075 kcal"],["Proteine target:", "165g (1.6g/kg)"],["Colazione timing:", "POST-workout 08:00"]]},
                    { title: "ğŸ¯ TARGET SETTIMANALI", items: [["Deficit:", "-825 kcal/giorno"],["Perdita:", "-0.75 kg"],["Controllo peso:", "GiovedÃ¬ mattina"],["Idratazione:", "3L + 500ml/ora sport"],["Window anabolica:", "30' post-functional"]]},
                    { title: "ğŸ“ˆ PROGRESSIONE CORSA", items: [["Settimana 1-2:", "Walk + 30\" run x10"],["Settimana 3-4:", "1' run / 2' walk x8"],["Settimana 5-6:", "2' run / 1' walk x8"],["Settimana 7-8:", "5' run / 1' walk x5"],["Settimana 9-12:", "35' corsa continua"]]},
                    { title: "ğŸ’Š TIMING BCAA", items: [["06:15 Pre-workout"],["10-15g BCAA/CaffÃ¨"],["Leucina + Isoleucina"],["Protezione muscolare"],["Massima ossidazione ğŸ”¥"]]}
                ];
                paramData.forEach(section => {
                    const sectionDiv = document.createElement('div'); sectionDiv.className = 'bg-[#ecf0f1] rounded-lg p-3';
                    const titleEl = document.createElement('h3'); titleEl.className = 'text-sm font-bold bg-[#34495e] text-white -mt-3 -mx-3 mb-3 p-2 rounded-t-lg'; titleEl.textContent = section.title; sectionDiv.appendChild(titleEl);
                    const list = document.createElement('ul'); list.className = 'space-y-1';
                    section.items.forEach(item => {
                        const li = document.createElement('li'); li.className = 'flex justify-between';
                        const key = document.createElement('span'); key.className = 'font-semibold'; key.textContent = item[0]; li.appendChild(key);
                        if (item[1]) { const value = document.createElement('span'); value.textContent = item[1]; li.appendChild(value); }
                        list.appendChild(li);
                    }); sectionDiv.appendChild(list); container.appendChild(sectionDiv);
                });
            }

            function addPhaseSection(title, color) {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td colspan="15" class="py-3 px-4 text-center text-sm font-bold text-white" style="background-color: ${color};">${title}</td>`;
                tbody.appendChild(tr);
            }

            function addDataRow(data, color, kcalTarget, currentDate) {
                const tr = document.createElement('tr'); tr.style.backgroundColor = color; tr.className = 'text-xs text-gray-700 align-middle';
                const daysSinceStart = (currentDate - planStartDate) / (1000 * 3600 * 24); tr.dataset.week = Math.floor(daysSinceStart / 7) + 1;
                const dateKey = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(currentDate.getDate()).padStart(2, '0')}`;

                data.slice(0, 8).forEach(cellData => { const td = document.createElement('td'); td.className = 'px-2 py-3 border-b border-gray-200'; td.innerHTML = cellData; tr.appendChild(td); });
                
                const createInputCell = (metric, type = 'number', placeholder = '') => {
                    const td = document.createElement('td'); td.className = 'px-2 py-3 border-b border-gray-200';
                    const input = document.createElement('input'); input.type = type; input.className = 'data-input'; input.placeholder = placeholder;
                    input.dataset.metric = metric; input.id = `${dateKey}-${metric}`;
                    if(type === 'number') input.step = '0.1';
                    td.appendChild(input); return { td, input };
                };
                
                // --- Creazione Input Cells ---
                const { td: tdPeso, input: inputPeso } = createInputCell('peso');
                tr.appendChild(tdPeso);
                const { td: tdFc, input: inputFc } = createInputCell('fc', 'text'); tr.appendChild(tdFc);
                const { td: tdPasso, input: inputPasso } = createInputCell('passo', 'text', 'min.dec'); tr.appendChild(tdPasso);
                const { td: tdSonno, input: inputSonno } = createInputCell('sonno', 'text', 'ore.dec'); tr.appendChild(tdSonno);
                const { td: tdCalOut, input: inputCalOut } = createInputCell('calout'); tr.appendChild(tdCalOut);
                const { td: tdCalIn, input: inputCalIn } = createInputCell('calin'); tr.appendChild(tdCalIn);
                inputCalIn.value = kcalTarget;

                // Bilancio
                const tdBilancio = document.createElement('td'); tdBilancio.className = 'px-2 py-3 border-b border-gray-200 text-center font-semibold';
                const spanBilancio = document.createElement('span'); tdBilancio.appendChild(spanBilancio); tr.appendChild(tdBilancio);

                // --- Event Listeners ---
                const calculateBalance = () => {
                    const calOutVal = parseFloat(inputCalOut.value); const calInVal = parseFloat(inputCalIn.value);
                    if (!isNaN(calOutVal) && !isNaN(calInVal)) {
                        const balance = calOutVal - calInVal;
                        spanBilancio.textContent = balance > 0 ? `+${Math.round(balance)}` : Math.round(balance);
                        if (balance <= -700 && balance >= -900) { spanBilancio.className = 'px-2 py-1 rounded-md bg-green-100 text-green-800'; }
                        else if (balance < -900) { spanBilancio.className = 'px-2 py-1 rounded-md bg-red-100 text-red-800'; }
                        else { spanBilancio.className = 'px-2 py-1 rounded-md bg-yellow-100 text-yellow-800'; }
                    } else {
                        spanBilancio.textContent = ''; spanBilancio.className = '';
                    }
                    updateProgressTracking();
                };

                const allInputs = [inputPeso, inputFc, inputPasso, inputSonno, inputCalOut, inputCalIn];
                allInputs.forEach(input => {
                    input.addEventListener('input', (e) => {
                        saveData(e.target.id, e.target.value);
                        if (e.target.dataset.metric === 'peso') {
                            const weight = parseFloat(e.target.value);
                            if (!isNaN(weight) && weight <= 95) e.target.classList.add('bg-green-100', 'text-green-800', 'font-bold');
                            else e.target.classList.remove('bg-green-100', 'text-green-800', 'font-bold');
                        }
                        if (['calout', 'calin'].includes(e.target.dataset.metric)) {
                            calculateBalance();
                        } else {
                            updateProgressTracking();
                        }
                    });
                });
                tbody.appendChild(tr);
            }

            function createStaticTable(containerId, title, titleColor, headers, data, headerColor, dataColor) {
                const container = document.getElementById(containerId);
                container.innerHTML = `
                    <h2 class="text-lg font-bold text-white text-center p-3 rounded-t-lg" style="background-color: ${titleColor};">${title}</h2>
                    <div class="overflow-x-auto border border-t-0 rounded-b-lg">
                        <table class="min-w-full"><thead style="background-color: ${headerColor};"><tr>${headers.map(h => `<th class="px-4 py-2 text-left text-xs font-bold text-white uppercase">${h}</th>`).join('')}</tr></thead>
                            <tbody style="background-color: ${dataColor};">${data.map(row => `<tr class="border-t">${row.map(cell => `<td class="px-4 py-2 text-sm text-gray-700">${cell}</td>`).join('')}</tr>`).join('')}</tbody>
                        </table></div>`;
            }

            function generateProgressTrackingTable() {
                const container = document.getElementById('progress-tracking');
                const headers = ["Settimana", "Peso", "Passo Medio", "FC Riposo", "Sonno Medio", "Deficit Medio", "Trend"];
                const weeks = [1, 2, 4, 6, 8, 10, 12];
                const trends = ['Baseline', 'Adattamento', 'Progressione', 'Sviluppo', 'Consolidamento', 'Intensificazione', 'TARGET!'];
                let tableBodyHtml = weeks.map((week, index) => `
                    <tr class="border-t">
                        <td class="px-4 py-2 text-sm text-gray-700 font-semibold">Settimana ${week}</td>
                        <td class="px-4 py-2 text-sm text-gray-700" id="track-w${week}-peso"></td>
                        <td class="px-4 py-2 text-sm text-gray-700" id="track-w${week}-passo"></td>
                        <td class="px-4 py-2 text-sm text-gray-700" id="track-w${week}-fc"></td>
                        <td class="px-4 py-2 text-sm text-gray-700" id="track-w${week}-sonno"></td>
                        <td class="px-4 py-2 text-sm text-gray-700" id="track-w${week}-deficit"></td>
                        <td class="px-4 py-2 text-sm text-gray-700">${trends[index]}</td>
                    </tr>`).join('');
                container.innerHTML = `
                    <h2 class="text-lg font-bold text-white text-center p-3 rounded-t-lg" style="background-color: #9b59b6;">ğŸ“Š TRACKING PROGRESSI E PERFORMANCE</h2>
                    <div class="overflow-x-auto border border-t-0 rounded-b-lg"><table class="min-w-full">
                        <thead style="background-color: #8e44ad;"><tr>${headers.map(h => `<th class="px-4 py-2 text-left text-xs font-bold text-white uppercase">${h}</th>`).join('')}</tr></thead>
                        <tbody style="background-color: #f4f1f7;">${tableBodyHtml}</tbody>
                    </table></div>`;
            }

            // --- DATI E LOGICA DI GENERAZIONE DEL PIANO ---
            function generatePhase0() {
                const data = [["24/09", "Mer", "â˜• CaffÃ¨ + 10g BCAA frutti rossi", "ğŸ’ª Functional Casa 55'", "ğŸš¶â€â™‚ï¸ Walk 6km + 30\" run x10", "ğŸ§€ Ricotta 120g + ğŸ¥“ Prosciutto 50g + ğŸ Pane 50g", "ğŸ Pasta 80g + ğŸŸ Tonno 100g", "ğŸ— Pollo 150g + ğŸ¥” Patate 150g"],["25/09", "Gio", "â˜• CaffÃ¨ + ğŸ¯ Miele 5g + H2O", "ğŸ’ª Functional Casa 55'", "ğŸš¶â€â™‚ï¸ Walk 6km + 30\" run x10", "ğŸ¥š Uova 2 + ğŸ¥“ Prosciutto 50g", "ğŸš Riso 80g + ğŸ¥š Uova 2", "ğŸŸ Pesce 150g + ğŸš Riso 60g"],["26/09", "Ven", "ğŸ¥¤ BCAA 12g limone + H2O", "ğŸ’ª Functional Casa 55'", "ğŸš¶â€â™‚ï¸ Walk recupero 45'", "ğŸ¥› Yogurt Greco 200g + ğŸ¥œ Noci 25g", "ğŸ Pasta 80g + ğŸ… Pomodoro", "ğŸ¦ƒ Tacchino 150g"],["27/09", "Sab", "â˜• CaffÃ¨ + 10g BCAA frutti rossi", "ğŸ’ª Functional Casa 55'", "ğŸš¶â€â™‚ï¸ Long Walk 10km + 2'", "ğŸ§€ Ricotta 120g + ğŸ¥“ Prosciutto 50g", "ğŸ Pasta 80g + ğŸŸ Tonno 100g", "ğŸ— Pollo 150g + ğŸ¥” Patate 150g"],["28/09", "Dom", "â˜• CaffÃ¨ + ğŸ¯ Miele 5g + H2O", "ğŸ’ª Functional Casa 55'", "ğŸ˜Œ Riposo attivo", "ğŸ¥š Uova 2 + ğŸ¥“ Prosciutto 50g", "ğŸš Riso 80g + ğŸ¥š Uova 2", "ğŸŸ Pesce 150g + ğŸš Riso 60g"],["29/09", "Lun", "ğŸ¥¤ BCAA 12g limone + H2O", "ğŸ’ª Functional Casa 55'", "ğŸš¶â€â™‚ï¸ Walk recupero 45'", "ğŸ¥› Yogurt Greco 200g + ğŸ¥œ Noci 25g", "ğŸ Pasta 80g + ğŸ… Pomodoro", "ğŸ¦ƒ Tacchino 150g"],["30/09", "Mar", "â˜• CaffÃ¨ + 10g BCAA frutti rossi", "ğŸ’ª Functional Casa 55'", "ğŸš¶â€â™‚ï¸ Walk 6km + 30\" run x10", "ğŸ§€ Ricotta 120g + ğŸ¥“ Prosciutto 50g", "ğŸ Pasta 80g + ğŸŸ Tonno 100g", "ğŸ— Pollo 150g + ğŸ¥” Patate 150g"]];
                const startDate = new Date(2025, 8, 24);
                data.forEach((row, index) => { const currentDate = new Date(startDate); currentDate.setDate(startDate.getDate() + index); addDataRow(row, "#fff5f5", 2075, currentDate); });
            }
            function generatePause(startDate, endDate) {
                const current = new Date(startDate);
                while (current <= endDate) { const rowData = [formatDate(current), getDayName(current), "ğŸ’¤ Niente", "ğŸ˜´ Riposo", "ğŸš¶â€â™‚ï¸ Walk leggera 30'", "Colazione normale", "Pranzo normale", "Cena normale"]; addDataRow(rowData, "#f8f9fa", 2200, new Date(current)); current.setDate(current.getDate() + 1); }
            }
            function generatePhase1() {
                const startDate = new Date(2025, 9, 5), endDate = new Date(2025, 9, 31);
                const pre = ["â˜• CaffÃ¨ + 10g BCAA", "â˜• CaffÃ¨ + ğŸ¯ Miele 5g", "ğŸ¥¤ BCAA 12g limone", "â˜• CaffÃ¨ + 10g BCAA"];
                const col = ["ğŸ§€ Ricotta 110g + ğŸ¥“ Prosciutto 50g", "ğŸ¥š Uova 2 + ğŸ¥“ Prosciutto 50g", "ğŸ¥› Yogurt Greco 180g + ğŸ¥œ Noci 25g", "ğŸ§€ Ricotta 110g + ğŸ¯ Miele"];
                const pra = ["ğŸ Pasta 75g + ğŸŸ Tonno 100g", "ğŸš Riso 75g + ğŸ¥š Uova 2", "ğŸ Pasta 75g + ğŸ… Pomodoro", "ğŸ«˜ Legumi 100g + ğŸš Riso 60g"];
                const cen = ["ğŸ— Pollo 150g + ğŸ¥” Patate 150g", "ğŸŸ Pesce 150g + ğŸš Riso 60g", "ğŸ¦ƒ Tacchino 150g", "ğŸ¥š Frittata 3 uova"];
                const current = new Date(startDate); let dayCount = 0;
                while (current <= endDate) {
                    const d = current.getDay(), w = Math.floor(dayCount / 7); let fun = "", car = "";
                    if ([1, 3, 5].includes(d)) { fun = "ğŸ’ª Self Functional 55'"; car = "ğŸš¶â€â™‚ï¸ Walk recupero 45'"; } else if ([2, 4].includes(d)) { fun = "ğŸ’ª Self Functional 55'"; car = w <= 1 ? "ğŸƒâ€â™‚ï¸ 1' run/2' walk x8" : "ğŸƒâ€â™‚ï¸ 1.5' run/2' walk x7"; } else if (d === 6) { fun = "ğŸ’ª Self Functional 55'"; car = "ğŸš¶â€â™‚ï¸ Long Walk 12km + 2x3' run"; } else { fun = "ğŸ˜Œ Riposo"; car = "ğŸ˜Œ Yoga/Stretching"; }
                    const rowData = [formatDate(current), getDayName(current), pre[dayCount % 4], fun, car, col[dayCount % 4], pra[dayCount % 4], cen[dayCount % 4]];
                    addDataRow(rowData, "#f0fffe", 2050, new Date(current)); current.setDate(current.getDate() + 1); dayCount++;
                }
            }
            function generatePhase2() {
                 const startDate = new Date(2025, 10, 4), endDate = new Date(2025, 11, 20);
                 const pre = ["â˜• CaffÃ¨ + 10g BCAA", "â˜• CaffÃ¨ + ğŸ¯ Miele 5g", "ğŸ¥¤ BCAA 12g limone", "â˜• CaffÃ¨ + 10g BCAA", "ğŸ¥¤ BCAA 10g + â˜• CaffÃ¨"];
                 const col = ["ğŸ§€ Ricotta 100g + ğŸ¥“ Prosciutto 45g", "ğŸ¥š Uova 2 + ğŸ¥“ Prosciutto 45g", "ğŸ¥› Yogurt Greco 170g + ğŸ¥œ Noci 22g", "ğŸ§€ Ricotta 100g + ğŸ¯ Miele", "ğŸ¥š Frittata 2 uova"];
                 const pra = ["ğŸ Pasta 70g + ğŸŸ Tonno 100g", "ğŸš Riso 70g + ğŸ¥š Uova 2", "ğŸ Pasta 70g + ğŸ… Pomodoro", "ğŸ«˜ Legumi 100g + ğŸš Riso 55g", "ğŸ² Minestrone + ğŸ Pane 40g"];
                 const cen = ["ğŸ— Pollo 140g + ğŸ¥” Patate 120g", "ğŸŸ Pesce 140g + ğŸš Riso 50g", "ğŸ¦ƒ Tacchino 140g", "ğŸ¥š Frittata 3 uova", "ğŸŸ Salmone 120g + ğŸ¥¬ Verdure"];
                 const current = new Date(startDate); let dayCount = 0;
                 while (current <= endDate) {
                    const d = current.getDay(), w = Math.floor(dayCount / 7); let fun = "", car = "";
                    if ([1, 3, 5].includes(d)) { fun = "ğŸ’ª Functional Palestra 55'"; car = "ğŸš¶â€â™‚ï¸ Walk recupero 45'"; } else if ([2, 4].includes(d)) { fun = "ğŸ’ª Functional Palestra 55'"; if (w <= 2) car = "ğŸƒâ€â™‚ï¸ 5' run/1' walk x5"; else if (w <= 4) car = "ğŸƒâ€â™‚ï¸ Corsa continua 25'"; else car = "ğŸƒâ€â™‚ï¸ Corsa continua 35'"; } else if (d === 6) { fun = "ğŸ’ª Functional Palestra 55'"; car = "ğŸš¶â€â™‚ï¸ Long Walk 15km + 2x5' run"; } else { fun = "ğŸ˜Œ Riposo"; car = "ğŸ˜Œ Recovery"; }
                    const rowData = [formatDate(current), getDayName(current), pre[dayCount % 5], fun, car, col[dayCount % 5], pra[dayCount % 5], cen[dayCount % 5]];
                    addDataRow(rowData, "#f0f8ff", 2000, new Date(current)); current.setDate(current.getDate() + 1); dayCount++;
                }
            }
            
            function generateAnalyticalSections() {
                generateProgressTrackingTable();
                createStaticTable('nutrition-guide', 'ğŸ¥— GUIDA NUTRIZIONALE E TIMING BCAA', '#27ae60', ["Timing", "Cosa", "Macro", "Obiettivo"], [["06:15", "Pre-workout", "â˜• CaffÃ¨ + 10g BCAA", "Energia + prot. muscolare"], ["08:00", "Post-workout", "Colazione completa", "Recovery + sazietÃ "], ["13:00", "Pranzo", "Proteine + Carboidrati", "Energia pomeriggio"], ["20:00", "Cena", "Proteine + Verdure", "Recovery notturno"]], '#229954', '#eafaf1');
                createStaticTable('advanced-goals', 'ğŸ¯ OBIETTIVI E MILESTONE', '#e74c3c', ["Corsa", "Peso", "Fitness", "Focus"], [["Sett 2: 1' run", "Sett 2: -1.5kg (102.5)", "FC <85 bpm", "Consistenza"], ["Sett 4: 5' run", "Sett 4: -3kg (101kg)", "Passo <18:00", "Progressione"], ["Sett 8: 20' run", "Sett 8: -6kg (98kg)", "Passo <17:00", "VelocitÃ "], ["Sett 12: 35' run", "Sett 12: -9kg (95kg)", "Passo <16:30", "TARGET!"]], '#c0392b', '#fadbd8');
            }

            // --- ESECUZIONE ---
            addMetabolicParameters();
            addPhaseSection("FASE 0 (24/09 - 30/09/2025): Adattamento + Test Baseline", "#ff6b6b");
            generatePhase0();
            addPhaseSection("PAUSA (01/10 - 04/10/2025): Recupero Attivo", "#95a5a6");
            generatePause(new Date(2025, 9, 1), new Date(2025, 9, 4));
            addPhaseSection("FASE 1 (05/10 - 31/10/2025): Build Aerobico", "#4ecdc4");
            generatePhase1();
            addPhaseSection("PAUSA (01/11 - 03/11/2025): Recupero Attivo", "#95a5a6");
            generatePause(new Date(2025, 10, 1), new Date(2025, 10, 3));
            addPhaseSection("FASE 2 (04/11 - 20/12/2025): Intensificazione + Target", "#45b7d1");
            generatePhase2();
            generateAnalyticalSections();
            loadAndApplyData(); // Carica i dati salvati alla fine
        });
    </script>
</body>
</html>

